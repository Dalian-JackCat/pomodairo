<?xml version="1.0" encoding="utf-8"?>
<s:BorderContainer
	xmlns:fx="http://ns.adobe.com/mxml/2009"
	xmlns:s="library://ns.adobe.com/flex/spark"
	xmlns:mx="library://ns.adobe.com/flex/mx"
	x="10" y="5" width="298" height="154" backgroundColor="#313131"
	creationComplete="init()">

	<fx:Script>
        <![CDATA[
        	import com.pomodairo.events.ConfigurationUpdatedEvent;
        	import com.pomodairo.PomodoroEventDispatcher;
        	import com.pomodairo.db.Storage;
			import flash.utils.Dictionary;
        	
			public static var POMODORO_LENGTH:String = "pomodoroLength";
			public static var SHORT_BREAK_LENGTH:String = "time.shortBreakLength";
			public static var LONG_BREAK_LENGTH:String = "time.longBreakLength";
			public static var LONG_BREAK_INTERVAL:String = "time.longBreakInterval";
			
        	private var pomodoroLength:Number = new Number(25);  
			private var shortBreakLength:Number = new Number(5);  
			private var longBreakLength:Number = new Number(20);  
			private var longBreakInterval:Number = new Number(4);  
        	
        	private function init():void
        	{
        		populate();
        		applyGuiValues();	
        	}
        	
        	public function populate():void
        	{
        		var props:Dictionary = Storage.instance.config;
        		
        		if (props[POMODORO_LENGTH] != null) 
        		{
        			pomodoroLength = props[POMODORO_LENGTH];
        		}
				
				if (props[SHORT_BREAK_LENGTH] != null) 
				{
					shortBreakLength = props[SHORT_BREAK_LENGTH];
				}
				
				if (props[LONG_BREAK_LENGTH] != null) 
				{
					longBreakLength = props[LONG_BREAK_LENGTH];
				}
        		
				if (props[LONG_BREAK_INTERVAL] != null) 
				{
					longBreakInterval = props[LONG_BREAK_INTERVAL];
				}
        	}
        	
        	private function applyGuiValues():void
            {
				pomodoroSlider.value = pomodoroLength;
				shortBreakSlider.value = shortBreakLength;
				longBreakSlider.value = longBreakLength;
				longBreakSelect.value = longBreakInterval;
            }
        	
            private function exit():void
            {
            	this.parent.removeChild(this);
            }
            
            public function save():void
            {
            	pomodoroLength = pomodoroSlider.value;
				shortBreakLength = shortBreakSlider.value;
				longBreakLength = longBreakSlider.value;
				longBreakInterval = longBreakSelect.value;
            	
            	Storage.instance.setConfigurationValue(POMODORO_LENGTH, ""+pomodoroLength);
				Storage.instance.setConfigurationValue(SHORT_BREAK_LENGTH, ""+shortBreakLength);
				Storage.instance.setConfigurationValue(LONG_BREAK_LENGTH, ""+longBreakLength);
				Storage.instance.setConfigurationValue(LONG_BREAK_INTERVAL, ""+longBreakInterval);
            	exit();
            	
            	notifyConfiguration();
            }
            
            public function notifyConfiguration():void
            {
            	// Notify the world 
            	PomodoroEventDispatcher.getInstance().dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, POMODORO_LENGTH, ""+pomodoroLength));
				PomodoroEventDispatcher.getInstance().dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, SHORT_BREAK_LENGTH, ""+shortBreakLength));
				PomodoroEventDispatcher.getInstance().dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, LONG_BREAK_LENGTH, ""+longBreakLength));
				PomodoroEventDispatcher.getInstance().dispatchEvent(new ConfigurationUpdatedEvent(ConfigurationUpdatedEvent.UPDATED, LONG_BREAK_INTERVAL, ""+longBreakInterval));
            }
			            
        ]]>
    </fx:Script>

	<s:Button x="221" y="90" label="Save" click="save()" width="63"/>
	<s:Button x="221" y="121" label="Cancel" click="exit()"/>
	
	<s:Label x="10" y="6" text="Pomodoro length" color="#A9A9A9"/>
	<s:HSlider id="pomodoroSlider" x="10" y="15" snapInterval="1" minimum="1" maximum="60"/>
	
	<s:Label x="10" y="48.3" text="Short break length" color="#A9A9A9"/>
	<s:HSlider id="shortBreakSlider" x="10" y="57" snapInterval="1" minimum="1" maximum="30"/>
	
	<s:Label x="10" y="91.3" text="Long break length" color="#A9A9A9"/>
	<s:HSlider id="longBreakSlider" x="10" y="100" snapInterval="1" minimum="1" maximum="60"/>
	<s:NumericStepper x="228" y="25" value="4" minimum="1" maximum="30" enabled="true" id="longBreakSelect" toolTip="Number of pomodoros until a long break"/>
	<s:Label x="176" y="7" text="Long break interval"/>
	
</s:BorderContainer>
